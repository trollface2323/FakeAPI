(()=>{"use strict";var t;!function(t){!function(t){t.AdLoaded="AdLoaded",t.AdStarted="AdStarted",t.AdStopped="AdStopped",t.AdSkipped="AdSkipped",t.AdSkippableStateChange="AdSkippableStateChange",t.AdSizeChange="AdSizeChange",t.AdLinearChange="AdLinearChange",t.AdDurationChange="AdDurationChange",t.AdExpandedChange="AdExpandedChange",t.AdRemainingTimeChange="AdRemainingTimeChange",t.AdVolumeChange="AdVolumeChange",t.AdImpression="AdImpression",t.AdVideoStart="AdVideoStart",t.AdVideoFirstQuartile="AdVideoFirstQuartile",t.AdVideoMidpoint="AdVideoMidpoint",t.AdVideoThirdQuartile="AdVideoThirdQuartile",t.AdVideoComplete="AdVideoComplete",t.AdClickThru="AdClickThru",t.AdInteraction="AdInteraction",t.AdUserAcceptInvitation="AdUserAcceptInvitation",t.AdUserMinimize="AdUserMinimize",t.AdUserClose="AdUserClose",t.AdPaused="AdPaused",t.AdPlaying="AdPlaying",t.AdLog="AdLog",t.AdError="AdError"}(t.DispatchedEvent||(t.DispatchedEvent={})),function(t){t.normal="normal",t.thumbnail="thumbnail",t.fullscreen="fullscreen"}(t.ViewMode||(t.ViewMode={}))}(t||(t={}));var e,i=function(){return i=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},i.apply(this,arguments)},n=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function a(t){try{d(n.next(t))}catch(t){r(t)}}function s(t){try{d(n.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}d((n=n.apply(t,e||[])).next())}))},o=function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(d){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(a=0)),a;)try{if(i=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,d])}}};!function(e){var r=function(){function e(){var e=this;this.version="2.0",this.TOP_LEFT_POSITION=1,this.TOP_RIGHT_POSITION=2,this.BOTTOM_LEFT_POSITION=3,this.BOTTOM_RIGHT_POSITION=4,this.MUTE_BUTTON=1,this.UNMUTE_BUTTON=2,this.CLOSE_BUTTON=3,this.MORE_BUTTON=4,this.BUY_BUTTON=5,this.events={},this.buttons={},this.previousVolume=1,this.adLinear=!1,this.adWidth=0,this.adHeight=0,this.adExpanded=!1,this.adSkippableState=!1,this.adRemainingTime=-1,this.adDuration=-1,this.adVolume=1,this.adCompanions="",this.adIcons=!1,this.visibilityPercent=0,this.fetchViewabilityCount=1,this.viewabilityInterval=null,this.viewabilityObserver=null,this.viewabilityTimer=2e3,this.viewabilityEndpointUrl="https://tracker.dsp-lab.ru/viewability",this.isError=!1,this.video=void 0,this.parameters={},this.progressCallbacks=[{event:t.DispatchedEvent.AdImpression,percent:0,called:!1},{event:t.DispatchedEvent.AdVideoStart,percent:0,called:!1},{event:t.DispatchedEvent.AdVideoFirstQuartile,percent:25,called:!1},{event:t.DispatchedEvent.AdVideoMidpoint,percent:50,called:!1},{event:t.DispatchedEvent.AdVideoThirdQuartile,percent:75,called:!1},{event:t.DispatchedEvent.AdVideoComplete,percent:100,called:!1,cb:function(){return e.stopAd()}}]}return e.prototype.subscribe=function(t,e,i){this.events[e]=null==t?void 0:t.bind(i)},e.prototype.unsubscribe=function(t){this.events[t]=void 0},e.prototype.handshakeVersion=function(t){return"2.0"},e.prototype.initAd=function(e,r,a,s,d,l){return n(this,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:this.adWidth=e,this.adHeight=r,o.label=1;case 1:return o.trys.push([1,4,,5]),this.slot=l.slot,this.parameters=i(i({},this.parameters),JSON.parse(d.AdParameters)),[4,this.loadVideo()];case 2:return o.sent(),[4,this.addButtons()];case 3:return o.sent(),this.eventSubscribe(),this.callEvent(t.DispatchedEvent.AdLoaded),[3,5];case 4:return n=o.sent(),this.error(n),[3,5];case 5:return[2]}}))}))},e.prototype.eventSubscribe=function(){var e=this;this.subscribe((function(){e.previousVolume=e.getAdVolume(),e.getAdVolume()>0?(e.changeBtnVisibility(e.MUTE_BUTTON,!0),e.changeBtnVisibility(e.UNMUTE_BUTTON,!1)):(e.changeBtnVisibility(e.MUTE_BUTTON,!1),e.changeBtnVisibility(e.UNMUTE_BUTTON,!0))}),t.DispatchedEvent.AdVolumeChange,this)},e.prototype.startAd=function(){var e=this;this.video.play().then(function(){return e.callEvent(t.DispatchedEvent.AdStarted)}.bind(this)).catch(function(t){return e.error(t)}.bind(this))},e.prototype.stopAd=function(){this.stopFetchViewability(),this.callEvent(t.DispatchedEvent.AdStopped),this.video.pause()},e.prototype.resizeAd=function(e,i,n){this.adWidth=e,this.adHeight=i,this.callEvent(t.DispatchedEvent.AdSizeChange)},e.prototype.pauseAd=function(){this.callEvent(t.DispatchedEvent.AdPaused),this.video.pause()},e.prototype.resumeAd=function(){this.callEvent(t.DispatchedEvent.AdPlaying),this.video.play()},e.prototype.expandAd=function(){this.adExpanded=!1,this.callEvent(t.DispatchedEvent.AdExpandedChange)},e.prototype.collapseAd=function(){this.adExpanded=!1,this.callEvent(t.DispatchedEvent.AdExpandedChange)},e.prototype.skipAd=function(){this.stopFetchViewability(),!1!==this.adSkippableState&&this.callEvent(t.DispatchedEvent.AdSkipped)},e.prototype.muteAd=function(){this.previousVolume=this.adVolume,this.setAdVolume(0)},e.prototype.unmuteAd=function(){this.setAdVolume(this.previousVolume||1)},e.prototype.getAdLinear=function(){return this.adLinear},e.prototype.getAdHeight=function(){return this.adHeight},e.prototype.getAdExpanded=function(){return this.adExpanded},e.prototype.getAdRemainingTime=function(){return Math.round(this.adRemainingTime/1e3)},e.prototype.getAdDuration=function(){return Math.round(this.adDuration/1e3)},e.prototype.getAdCompanions=function(){return this.adCompanions},e.prototype.getAdVolume=function(){return this.adVolume},e.prototype.getAdWidth=function(){return this.adWidth},e.prototype.setAdVolume=function(e){isNaN(e)||e<0||e>1||(this.adVolume=e,this.callEvent(t.DispatchedEvent.AdVolumeChange))},e.prototype.getAdIcons=function(){var t,e,i;return void 0!==(null===(t=this.parameters)||void 0===t?void 0:t.buttons)&&(null===(i=null===(e=this.parameters)||void 0===e?void 0:e.buttons)||void 0===i?void 0:i.length)>0},e.prototype.getAdSkippableState=function(){return this.adSkippableState},e.prototype.callEvent=function(e,i){var n;void 0!==this.events[e]&&(e===t.DispatchedEvent.AdClickThru?(n=this.events)[e].apply(n,i):this.events[e](i))},e.prototype.error=function(e){!0!==this.isError&&(this.isError=!0,this.callEvent(t.DispatchedEvent.AdError,e))},e.prototype.click=function(e,i,n){this.callEvent(t.DispatchedEvent.AdClickThru,[e,i,n])},e.prototype.loadVideo=function(){return n(this,void 0,void 0,(function(){var e,i,n,r=this;return o(this,(function(o){return e=null===(n=this.parameters)||void 0===n?void 0:n.video,i=function(i,n){if(void 0===e)return n();r.video=document.createElement("video"),r.video.src=e,r.video.width=r.adWidth,r.video.height=r.adHeight,r.video.muted=!0,r.video.controls=!1,r.video.autoplay=!1,r.video.load(),r.video.addEventListener("durationchange",(function(){return r.callEvent(t.DispatchedEvent.AdDurationChange)})),r.video.addEventListener("timeupdate",(function(t){return r.handleProgress(t)})),r.video.addEventListener("ended",(function(){return r.ended()})),r.video.addEventListener("click",(function(){return r.click(null,null,!0)})),r.slot.append(r.video),r.setupViewabilityTracking(),i()}.bind(this),[2,new Promise(i)]}))}))},e.prototype.handleVisibility=function(){var t={clickid:this.parameters.clickid,t:Date.now().toString(),i:this.fetchViewabilityCount.toString(),viewability:this.visibilityPercent.toString()},e=new URLSearchParams(t).toString();console.log(123),fetch("".concat(this.viewabilityEndpointUrl,"?").concat(e)),this.fetchViewabilityCount++},e.prototype.stopFetchViewability=function(){this.viewabilityObserver.unobserve(this.video),null!==this.viewabilityInterval&&(clearInterval(this.viewabilityInterval),this.viewabilityInterval=null)},e.prototype.setupViewabilityTracking=function(){var t=this;this.viewabilityObserver=new IntersectionObserver((function(e){e.forEach((function(e){var i=e.intersectionRatio;t.visibilityPercent=Math.round(100*i),null===t.viewabilityInterval&&(t.viewabilityInterval=setInterval((function(){return t.handleVisibility()}),t.viewabilityTimer))}))}),{threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}),this.viewabilityObserver.observe(this.video)},e.prototype.changeBtnVisibility=function(t,e){var i;void 0!==(null===(i=this.buttons)||void 0===i?void 0:i[t])&&(this.buttons[t].style.visibility=e?"visible":"hidden")},e.prototype.addButtons=function(){return n(this,void 0,void 0,(function(){var t,e,i,n=this;return o(this,(function(o){return t=null===(i=this.parameters)||void 0===i?void 0:i.buttons,e=function(e){if(!Array.isArray(t))return e();n.adIcons=!0;for(var i=0;i<t.length;i++){var o=t[i],r=document.createElement("a");switch(r.style.position="absolute",o.type===n.MUTE_BUTTON&&0===n.getAdVolume()&&(r.style.visibility="hidden"),o.type===n.UNMUTE_BUTTON&&0!==n.getAdVolume()&&(r.style.visibility="hidden"),o.position){case n.TOP_LEFT_POSITION:r.style.left="".concat(o.x,"px"),r.style.top="".concat(o.y,"px");break;case n.TOP_RIGHT_POSITION:r.style.right="".concat(o.x,"px"),r.style.top="".concat(o.y,"px");break;case n.BOTTOM_LEFT_POSITION:r.style.left="".concat(o.x,"px"),r.style.bottom="".concat(o.y,"px");break;case n.BOTTOM_RIGHT_POSITION:r.style.right="".concat(o.x,"px"),r.style.bottom="".concat(o.y,"px")}var a=document.createElement("img");switch(a.src=o.url,r.append(a),o.type){case n.CLOSE_BUTTON:r.addEventListener("click",(function(){return n.stopAd()}));break;case n.MUTE_BUTTON:r.addEventListener("click",(function(){return n.muteAd()}));break;case n.UNMUTE_BUTTON:r.addEventListener("click",(function(){return n.unmuteAd()}));break;case n.MORE_BUTTON:case n.BUY_BUTTON:r.addEventListener("click",(function(){return n.click(null,null,!0)}))}n.buttons[o.type]=r,n.slot.append(r)}e()}.bind(this),[2,new Promise(e)]}))}))},e.prototype.handleProgress=function(e){var i=this,n=e.target;if(!isNaN(n.duration)&&!isNaN(n.currentTime)){this.adDuration=n.duration,this.adRemainingTime=n.duration-n.currentTime,this.callEvent(t.DispatchedEvent.AdRemainingTimeChange,this.adRemainingTime);var o=Math.round(n.currentTime/n.duration*100);this.progressCallbacks.map((function(t){var e;!0!==t.called&&(t.percent>o||(i.callEvent(t.event),t.called=!0,null===(e=t.cb)||void 0===e||e.call(t)))}))}},e.prototype.ended=function(){var e=this;this.stopFetchViewability(),this.progressCallbacks.map((function(i){var n;i.called||i.event==t.DispatchedEvent.AdVideoComplete&&(e.callEvent(i.event),i.called=!0,null===(n=i.cb)||void 0===n||n.call(i))}))},e}();e.VPAID=r}(e||(e={})),window.getVPAIDAd=function(){return new e.VPAID}})();